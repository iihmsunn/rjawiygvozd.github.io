Голос: <select id="voiceselect"></select><br /><br />
Прочитать текст:<br /><textarea id="ttsinput"></textarea><br />
<button id="speakButton">Говорить</button><br />
<audio id="player"></audio>
<input id="speechenabled" type="checkbox" checked />Говорить выделяемый текст
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js" type="text/javascript"></script>
<script type="text/javascript">// <![CDATA[
var ttspath = "http://rjgvozd.no-ip.org:8082/TtsService.svc";
var attempts = 0;
var wait = false;

function getVoices(){
	$.ajax({
		url: ttspath + "/GetVoices",
		type: 'GET',
		async: true,
		contentType: 'application/json; charset=utf-8',
		dataType: 'json',
	})
	.done(function(data) {
		var select = $("#voiceselect");
		data.forEach(function(element,index,array){
			select.append($('<option value="' + element + '">' + element + '</option>'));
		});
	});
}

function getSelectionText() {
    var text = "";
    if (window.getSelection) {
        text = window.getSelection().toString();
    } else if (document.selection && document.selection.type != "Control") {
        text = document.selection.createRange().text;
    }
    return text;
}
function onmouseup() {
	setTimeout(function(){
		var st = getSelectionText();
    if (st != "") {
        
        if (st.length > 1932) {
            st = st.substring(0, 1932);
            st = st.substring(0, st.lastIndexOf(".")) + ".";
        }
        var enabled = $('#speechenabled').is(':checked');
        if (enabled && !wait) {
        	speak($("#voiceselect").val(), st);
        	//wait = true;
        }
    }	
	},100);
}
function speak(voice, text){
	var input = {voice: voice, text: text};
	$.ajax({
		url: ttspath + "/Speak",
		type: 'POST',
		async: true,
		data: JSON.stringify(input),
		contentType: 'application/json; charset=utf-8',
		dataType: 'json',
		timeout: 1000
	})
	.done(function(data) {
		if (data != "fail"){
			console.log("success");
			$("#player").attr("src", ttspath + "/Play?filename=" + data);
			$("#player")[0].play();	
		}
		else{
			attempts = attempts + 1;
			console.log("error");
			setTimeout(function(){
				if (attempts < 15) speak(voice, text);
				else attempts = 0;
			}, 1000);
		}
	})
	.fail(function(data) {
		attempts = attempts + 1;
		console.log("error");
        if (attempts < 15) speak(voice, text);
		else attempts = 0;
	});
}

$(document).ready(function(){
	$("#player").bind('ended', function(){
		wait = false;
	});
	$("#player").bind('play', function(){
		wait = true;
	});
	$('body').bind("mouseup", onmouseup);
	$("#speakButton").click(function(){
		var txt = $("#ttsinput").val();
		speak($("#voiceselect").val(), txt);
	});
	getVoices();
});
// ]]></script>
